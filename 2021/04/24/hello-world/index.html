<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Hello World · 云中行走</title><meta name="description" content="Hello World - 你猜"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://github.com/ER-Tiylor/ER_Tiylor.github.io/atom.xml" title="云中行走"><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="云中行走" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/sunchongsheng" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/pinggod" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Hello World</h1><div class="post-info">2021年4月24日</div><div class="post-content"><p>传统网站存在的问题</p>
<p>网速慢时，只能等待</p>
<p>表单提交后，如果内容一项不合格，就需要重新填写所有表单内容</p>
<p>页面跳转，需要重新加载整个页面，造成资源浪费</p>
<h3 id="Ajax概述"><a href="#Ajax概述" class="headerlink" title="Ajax概述"></a>Ajax概述</h3><p><strong>Asynchronous JavaScript and XML</strong>”（异步的<a href="https://zh.wikipedia.org/wiki/JavaScript" target="_blank" rel="noopener">JavaScript</a>与<a href="https://zh.wikipedia.org/wiki/XML" target="_blank" rel="noopener">XML</a>技术）–<a href="https://zh.wikipedia.org/wiki/AJAX" target="_blank" rel="noopener">wikipedia</a></p>
<p>是浏览器提供的一套方法，可以实现页面无刷新更新数据，提高用户浏览网站应用的体验</p>
<h3 id="Ajax-应用场景"><a href="#Ajax-应用场景" class="headerlink" title="Ajax 应用场景"></a>Ajax 应用场景</h3><ol>
<li><p>页面上拉加载更多数据</p>
</li>
<li><p>列表数据无刷新分页</p>
</li>
<li><p>表单项离开焦点数据验证</p>
</li>
<li><p>搜索框提示文字下拉列表</p>
</li>
</ol>
<h3 id="Ajax的运行环境"><a href="#Ajax的运行环境" class="headerlink" title="Ajax的运行环境"></a>Ajax的运行环境</h3><p>Ajax技术需要运行在网站环境中才能生效，当前会使用Node创建的服务器作为网站服务器</p>
<p>【需要express基础，学完再来】… …【回来继续】</p>
<h4 id="Ajax-运行原理"><a href="#Ajax-运行原理" class="headerlink" title="Ajax 运行原理"></a>Ajax 运行原理</h4><p>Ajax相当于<strong>浏览器发送请求与接收响应的代理人</strong>，以实现在不影响用户浏览页面的情况下，局部更新页面数据，从而提高用户体验</p>
<p><img src="E:%5C0a%E6%96%87%E6%A1%A3%5C%E5%89%8D%E7%AB%AF%E7%AC%94%E8%AE%B0%5Cimage-20200508122726537.png" alt="image-20200508122726537"></p>
<h4 id="Ajax的使用步骤"><a href="#Ajax的使用步骤" class="headerlink" title="Ajax的使用步骤"></a>Ajax的使用步骤</h4><ol>
<li><p>创建Ajax对象</p>
<figure class="highlight plain"><figcaption><span>xhr </span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2. 告诉Ajax请求地址以及请求方式</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96; xhr.open(&#39;get&#39;,&#39;https:&#x2F;&#x2F;www.gsau.edu.cn&#39;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>发送请求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">4. 获取服务器端给客户端的响应数据</span><br><span class="line"></span><br><span class="line">   &#96;&#96;&#96;js</span><br><span class="line">   xhr.onload&#x3D; function()&#123;</span><br><span class="line">   	console.log(xhr.responseText)</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>下面就是示例：在pubic文件夹下的01Ajax入门.html文件中定义了Ajax请求，路由是/first,然后在服务器端即app.js中，响应了hello Ajax，在Ajax中使用<code>xhr.responseText</code>即可得到这个响应信息。</p>
</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="actionscript">		<span class="comment">// 1 创建Ajax对象</span></span></span><br><span class="line"><span class="actionscript">		<span class="keyword">const</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span></span><br><span class="line"><span class="actionscript">		<span class="comment">// 2 以什么方式向哪发送请求  用open方法设置请求方式 请求地址</span></span></span><br><span class="line"><span class="actionscript">		xhr.open(<span class="string">'get'</span>,<span class="string">'http://localhost:3000/first'</span>)</span></span><br><span class="line"><span class="actionscript">		<span class="comment">// 3 发送请求</span></span></span><br><span class="line">		xhr.send()</span><br><span class="line"><span class="actionscript">		<span class="comment">// 4 获取服务器响应到客户端的数据 xhr.responseText</span></span></span><br><span class="line"><span class="actionscript">		<span class="comment">// 当Ajax接收完服务器端的响应数据后触发onload事件</span></span></span><br><span class="line"><span class="actionscript">		xhr.onload = <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="built_in">console</span>.log(xhr.responseText)</span></span><br><span class="line">		&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入express框架</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="comment">// 路径处理模块</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="comment">// 创建web服务器</span></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 静态资源访问服务功能</span></span><br><span class="line">app.use(express.static(path.join(__dirname,<span class="string">'public'</span>)));</span><br><span class="line">app.get(<span class="string">'/first'</span>,(req,res)=&gt;&#123;</span><br><span class="line">	res.send(<span class="string">'hello ajax'</span>)<span class="comment">// 响应给客户端的信息</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'服务器启动成功'</span>)</span><br></pre></td></tr></table></figure>

<p><img src="E:%5C0a%E6%96%87%E6%A1%A3%5C%E5%89%8D%E7%AB%AF%E7%AC%94%E8%AE%B0%5Cimage-20200508130147324.png" alt="image-20200508130147324"></p>
<h4 id="服务器端响应的数据格式"><a href="#服务器端响应的数据格式" class="headerlink" title="服务器端响应的数据格式"></a>服务器端响应的数据格式</h4><p>​    在真实的项目中，<strong>服务器端大多数情况下会以JSON对象作为响应数据的格式</strong>。当客户端拿到响应数据时，要将JSON数据和HTML 字符串进行拼接，然后将字符串的结果展示在页面中。</p>
<p>​    在http请求与响应的过程中，无论是请求参数还是响应内容，如果是对象类型，最终都会转换为对象字符串进行传输。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">'/responseData'</span>,(req,res)=&gt;&#123;</span><br><span class="line">	res.send(&#123;<span class="string">'name'</span>:<span class="string">'zs'</span>&#125;);</span><br><span class="line">&#125;)  <span class="comment">// S：服务端响应JSON数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// C：客户端发送Ajax请求并得到返回数据</span></span><br><span class="line"><span class="comment">// 1 创建Ajax对象</span></span><br><span class="line">		<span class="keyword">const</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">		<span class="comment">// 2 以什么方式向哪发送请求  用open方法设置请求方式 请求地址</span></span><br><span class="line">		xhr.open(<span class="string">'get'</span>,<span class="string">'http://localhost:3000/responseData'</span>)</span><br><span class="line">		<span class="comment">// 3 发送请求</span></span><br><span class="line">		xhr.send()</span><br><span class="line">		<span class="comment">// 4 获取服务器响应到客户端的数据 xhr.responseText</span></span><br><span class="line">		<span class="comment">// 当Ajax接收完服务器端的响应数据后触发onload事件</span></span><br><span class="line">		xhr.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">			<span class="built_in">console</span>.log(xhr.responseText)  <span class="comment">// 字符串格式</span></span><br><span class="line">			<span class="comment">// console.log(typeof xhr.responseText)</span></span><br><span class="line">			<span class="keyword">var</span> responseText = <span class="built_in">JSON</span>.parse(xhr.responseText)<span class="comment">//将json字符串转换为json对象</span></span><br><span class="line">			<span class="built_in">console</span>.log(responseText) <span class="comment">// 对象类型</span></span><br><span class="line">			<span class="keyword">var</span> str = <span class="string">'&lt;h2&gt;'</span>+responseText.name+<span class="string">'&lt;/h2&gt;'</span> <span class="comment">// 通过DOM操作，将数据写入页面</span></span><br><span class="line">			<span class="built_in">document</span>.body.innerHTML = str;</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>

<h4 id="请求参数-传递"><a href="#请求参数-传递" class="headerlink" title="请求参数 传递"></a>请求参数 传递</h4><p>传统网站表单提交，get方式会将参数放到地址后面，post参数会放到请求体里面。</p>
<h5 id="Ajax-GET"><a href="#Ajax-GET" class="headerlink" title="Ajax -GET"></a>Ajax -GET</h5><p>Get请求方式：<code>xhr.open(&#39;get&#39;,&#39;http://localhost:3000?name=zs&amp;age=20&#39;)</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> params =<span class="string">'username='</span>+nameValue+<span class="string">'&amp;age='</span>+ageValue+<span class="string">''</span> <span class="comment">// 需要自己拼接请求参数</span></span><br><span class="line"></span><br><span class="line">xhr.open(<span class="string">'get'</span>,<span class="string">'http://localhost:3000/get?'</span>+params) <span class="comment">//设置请求方式和请求的完整地址</span></span><br><span class="line"></span><br><span class="line">xhr.send() <span class="comment">// 发送请求</span></span><br><span class="line">xhr.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(xhr.responseText)</span><br><span class="line">	&#125; <span class="comment">// 输出服务端的返回值</span></span><br></pre></td></tr></table></figure>

<h5 id="Ajax-POST"><a href="#Ajax-POST" class="headerlink" title="Ajax-POST"></a>Ajax-POST</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xhr.setRequestHeader(<span class="string">'Content-Type'</span>,<span class="string">'application/x-www-form-urlencoded'</span>)</span><br><span class="line">xhr.send(<span class="string">'name=zhangsan&amp;age=20'</span>);</span><br></pre></td></tr></table></figure>

<p>post请求需要在请求头明确设置请求参数的类型，即Content-Type属性</p>
<blockquote>
<p>回顾：HTTP请求和响应过程中传递的数据块就叫报文</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端</span></span><br><span class="line"><span class="keyword">var</span> params =<span class="string">'username='</span>+nameValue+<span class="string">'&amp;age='</span>+ageValue;</span><br><span class="line"></span><br><span class="line">			xhr.open(<span class="string">'post'</span>,<span class="string">'http://localhost:3000/post'</span>)</span><br><span class="line">		</span><br><span class="line">			xhr.setRequestHeader(<span class="string">'Content-Type'</span>,<span class="string">'application/x-www-form-urlencoded'</span>) <span class="comment">//设置请求参数的类型</span></span><br><span class="line">			xhr.send(params)</span><br><span class="line">			xhr.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">				<span class="built_in">console</span>.log(xhr.responseText)</span><br><span class="line">			&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 服务端</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>)</span><br><span class="line">app.use( bodyParser.urlencoded(&#123;<span class="attr">extended</span>: <span class="literal">true</span>&#125;) )</span><br><span class="line">...</span><br><span class="line">app.post(<span class="string">'/post'</span>,(req,res)=&gt;&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(req)</span><br><span class="line">	res.send(req.body)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><img src="AJAX.assets/image-20200513162946406.png" alt="image-20200513162946406"></p>
<blockquote>
<p>body-parser相关的可以访问<a href="https://www.cnblogs.com/lovekiku123/p/11961094.html和https://blog.csdn.net/web_youth/article/details/80053187?utm_source=blogxgwz0，了解" target="_blank" rel="noopener">https://www.cnblogs.com/lovekiku123/p/11961094.html和https://blog.csdn.net/web_youth/article/details/80053187?utm_source=blogxgwz0，了解</a></p>
</blockquote>
<h4 id="请求参数的格式"><a href="#请求参数的格式" class="headerlink" title="请求参数的格式"></a>请求参数的格式</h4><p><strong>Content-Type类型</strong>：</p>
<ol>
<li><p><code>application/x-www-form-urlecoded</code>  </p>
<p>传统表单提交就是这种参数格式，<strong>GET请求只能提交这种参数格式</strong></p>
<p>​    <code>name=zhangsan&amp;age=20</code></p>
</li>
<li><p><code>application/json</code> </p>
<p>提交json格式的数据 ，需要POST方式提交</p>
<p>​    <code>JSON.stringify() //将json对象转换为json字符串</code></p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端</span></span><br><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line"></span><br><span class="line">xhr.open(<span class="string">'post'</span>,<span class="string">'http://localhost:3000/json'</span>)</span><br><span class="line">		</span><br><span class="line">xhr.setRequestHeader(<span class="string">'Content-Type'</span>,<span class="string">'application/json'</span>) <span class="comment">//设置请求参数的类型</span></span><br><span class="line"></span><br><span class="line">xhr.send(<span class="built_in">JSON</span>.stringify(&#123;<span class="attr">name</span>:<span class="string">'zhangsan'</span>,<span class="attr">age</span>:<span class="number">20</span>&#125;))</span><br><span class="line"></span><br><span class="line">xhr.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(xhr.responseText)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 服务端</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>)</span><br><span class="line">app.use(bodyParser.json());</span><br><span class="line">...</span><br><span class="line">app.post(<span class="string">'/json'</span>,(req,res)=&gt;&#123;</span><br><span class="line">	res.send(req.body)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><img src="AJAX.assets/image-20200513164603450.png" alt="image-20200513164603450"></p>
<ol start="3">
<li><p><code>text/xml</code>    提交xml格式的数据</p>
</li>
<li><p><code>multipart/form-data</code> 文件提交</p>
</li>
</ol>
<h4 id="获取服务器端的响应"><a href="#获取服务器端的响应" class="headerlink" title="获取服务器端的响应"></a>获取服务器端的响应</h4><p>Ajax 状态码：在创建ajax对象，配置ajax对象，发送请求，以及接收完服务端响应数据，这个过程中的<strong>每一个步骤</strong>都会对应一个数值，这个数值就是ajax状态码</p>
<ol start="0">
<li><p>请求未初始化，open未设置</p>
</li>
<li><p>请求已建立，open以配置，未发送，未调用send方法 </p>
</li>
<li><p>请求已发送 </p>
</li>
<li><p>请求处理中，接受到了部分数据，正在接受服务端的响应数据 </p>
</li>
<li><p>响应数据接受完成，客户端可以使用响应数据了</p>
</li>
</ol>
<p>获取ajax状态码（readyState属性）：<code>xhr.readyState</code></p>
<p>onreadystatechange 事件</p>
<p>当Ajax状态码发生变化时将自动触发该事件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line"><span class="built_in">console</span>.log(xhr.readyState)</span><br><span class="line"><span class="comment">// // 2 以什么方式向哪发送请求  用open方法设置请求方式 请求地址</span></span><br><span class="line">xhr.open(<span class="string">'get'</span>,<span class="string">'http://localhost:3000/readyState'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// // 3 发送请求</span></span><br><span class="line">		</span><br><span class="line"><span class="built_in">console</span>.log(xhr.readyState)</span><br><span class="line">xhr.onreadystatechange=<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(xhr.readyState)</span><br><span class="line">&#125;</span><br><span class="line">xhr.send()</span><br></pre></td></tr></table></figure>

<p><img src="AJAX.assets/image-20200513172332274.png" alt="image-20200513172332274"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">xhr.onreadystatechange=<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(xhr.readyState==<span class="number">4</span>)&#123;</span><br><span class="line">				<span class="built_in">console</span>.log(xhr.responseText)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		xhr.send()</span><br></pre></td></tr></table></figure>

<p><img src="AJAX.assets/image-20200513172444084.png" alt="image-20200513172444084"></p>
<p><img src="AJAX.assets/EB53555AF6B307DCCF82F4A5C60379AF.png" alt="EB53555AF6B307DCCF82F4A5C60379AF"></p>
<h4 id="Ajax-错误处理"><a href="#Ajax-错误处理" class="headerlink" title="Ajax 错误处理"></a>Ajax 错误处理</h4><ol>
<li><p>网络畅通，服务端能接受到请求，服务端返回的结果不是预期结果</p>
<p>可以判断服务器端返回的状态码，分别进行处理，<code>xhr.status</code> 获取http状态码</p>
</li>
<li><p>网络畅通，服务器端没有接收到请求，返回404状态码</p>
<p>检查请求地址是否错误 </p>
</li>
<li><p>网络畅通，服务器端能接受到请求，服务器端返回500状态码（内部服务器错误）</p>
<figure class="highlight plain"><figcaption><span>http://localhost:3000/error 500 (Internal Server Error) ```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">4. 网络中断，请求无法发送到服务器端</span><br><span class="line"></span><br><span class="line">   会触发xhr对象下面的onerror事件，在onerror事件处理函数中对错误进行处理</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;js</span><br><span class="line">&#x2F;&#x2F; 客户端</span><br><span class="line">&lt;button id&#x3D;&quot;btn&quot;&gt;发送ajax请求&lt;&#x2F;button&gt;</span><br><span class="line">	&lt;script type&#x3D;&quot;text&#x2F;javascript&quot;&gt;</span><br><span class="line">		var btn &#x3D; document.getElementById(&#39;btn&#39;);</span><br><span class="line">		btn.addEventListener(&#39;click&#39;,()&#x3D;&gt;&#123;</span><br><span class="line">			const xhr &#x3D; new XMLHttpRequest();</span><br><span class="line">		&#x2F;&#x2F; 2 以什么方式向哪发送请求  用open方法设置请求方式 请求地址</span><br><span class="line">		xhr.open(&#39;get&#39;,&#39;http:&#x2F;&#x2F;localhost:3000&#x2F;error&#39;)</span><br><span class="line">		&#x2F;&#x2F; 3 发送请求</span><br><span class="line">		xhr.send()</span><br><span class="line">		&#x2F;&#x2F; 4 获取服务器响应到客户端的数据 xhr.responseText</span><br><span class="line">		&#x2F;&#x2F; 当Ajax接收完服务器端的响应数据后触发onload事件</span><br><span class="line">		xhr.onload &#x3D; function()&#123;</span><br><span class="line">			&#x2F;&#x2F; console.log(xhr.status) &#x2F;&#x2F; http 状态码</span><br><span class="line">			console.log(xhr.responseText)</span><br><span class="line">			if(xhr.status &#x3D;&#x3D; 400)&#123;</span><br><span class="line">				alert(&#39;请求出错&#39;)</span><br><span class="line">			&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		xhr.onerror &#x3D; ()&#x3D;&gt;&#123;</span><br><span class="line">			alert(&#39;网络中断，无法发送Ajax请求&#39;)</span><br><span class="line">		&#125;</span><br><span class="line">		&#125;)</span><br><span class="line">	&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 服务端</span></span><br><span class="line">app.get(<span class="string">'/error'</span>,(req,res)=&gt;&#123;</span><br><span class="line">	<span class="comment">// console.log(zbc)</span></span><br><span class="line">	res.status(<span class="number">400</span>).send(<span class="string">'not ok'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<p><img src="AJAX.assets/image-20200513183014884.png" alt="image-20200513183014884"></p>
<p>ajax状态码表示Ajax请求的过程状态，是ajax对象返回的，HTTP状态码表示请求的处理结果，是服务器端返回的。</p>
<h4 id="低版本IE浏览器的缓存问题"><a href="#低版本IE浏览器的缓存问题" class="headerlink" title="低版本IE浏览器的缓存问题"></a>低版本IE浏览器的缓存问题</h4><blockquote>
<p>问题：在低版本的IE浏览器中，Ajax请求有着严重的缓存问题，即在请求地址不发生变化的情况下，只有第一次请求会真正发送到服务器端，后续的请求都会从浏览器的缓存中获取结果。即使服务器端的数据更新了，客户端依然拿到的是缓存中的旧数据。</p>
</blockquote>
<p><strong>解决方案</strong>:</p>
<p>在请求地址的后面加请求参数，保证每一次请求中的请求参数的值不相同</p>
<p>`` xhr.open(‘get’,’<a href="http://localhost:3000?t=&#39;+Math.random()" target="_blank" rel="noopener">http://localhost:3000?t=&#39;+Math.random()</a>); `</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端</span></span><br><span class="line">&lt;button id=<span class="string">"btn"</span>&gt;发送ajax请求&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">	&lt;script type="text/</span>javascript<span class="string">"&gt;</span></span><br><span class="line"><span class="string">		var btn = document.getElementById('btn');</span></span><br><span class="line"><span class="string">		btn.onclick = function()&#123;</span></span><br><span class="line"><span class="string">			var xhr = new XMLHttpRequest();</span></span><br><span class="line"><span class="string">			// 2 以什么方式向哪发送请求  用open方法设置请求方式 请求地址</span></span><br><span class="line"><span class="string">			xhr.open('get','http://localhost:3000/cache?t='+Math.random())</span></span><br><span class="line"><span class="string">			// 3 发送请求</span></span><br><span class="line"><span class="string">			xhr.send()</span></span><br><span class="line"><span class="string">			// 4 获取服务器响应到客户端的数据 xhr.responseText</span></span><br><span class="line"><span class="string">			// 当Ajax接收完服务器端的响应数据后触发onload事件</span></span><br><span class="line"><span class="string">			xhr.onreadystatechange = function()&#123;</span></span><br><span class="line"><span class="string">				// console.log(xhr.status) // http 状态码</span></span><br><span class="line"><span class="string">					if(xhr.readyState == 4 &amp;&amp; xhr.status == 200)&#123;</span></span><br><span class="line"><span class="string">						alert(xhr.responseText)</span></span><br><span class="line"><span class="string">					&#125;</span></span><br><span class="line"><span class="string">				&#125;</span></span><br><span class="line"><span class="string">		&#125;	</span></span><br><span class="line"><span class="string">	&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 服务端</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line">...</span><br><span class="line">app.get(<span class="string">'/cache'</span>,(req,res)=&gt;&#123;</span><br><span class="line">	fs.readFile(<span class="string">'./test.txt'</span>,(err,result)=&gt;&#123;</span><br><span class="line">		res.send(result)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="AJAX.assets/image-20200513192848878.png" alt="image-20200513192848878"></p>
<h3 id="异步编程"><a href="#异步编程" class="headerlink" title="异步编程"></a>异步编程</h3><h4 id="同步异步概述"><a href="#同步异步概述" class="headerlink" title="同步异步概述"></a>同步异步概述</h4><p><strong>同步</strong>，做完一件事，才能做下一件事，一行代码执行完才能执行下一行代码；</p>
<p><strong>异步</strong>，开始做一件事，中途可以做其他事，回来可以接着做这件未完成的事，代码而言就是，程序不会等待异步代码执行完毕才去执行下一行代码，而是接着执行下面的代码，当异步代码执行完毕之后，就自动调用准备好的回调函数执行操作，如计时器。</p>
<p><img src="AJAX.assets/2D12FEE455FCC485507FE39CA241AD74.png" alt="2D12FEE455FCC485507FE39CA241AD74"></p>
<p>而Ajax是异步请求，所以如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">		<span class="comment">// 1 创建Ajax对象</span></span><br><span class="line"><span class="keyword">const</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">		<span class="comment">// 2 以什么方式向哪发送请求  用open方法设置请求方式 请求地址</span></span><br><span class="line">xhr.open(<span class="string">'get'</span>,<span class="string">'http://localhost:3000/first'</span>)</span><br><span class="line">		<span class="comment">// 3 发送请求</span></span><br><span class="line">xhr.send()</span><br><span class="line">		<span class="comment">// 4 获取服务器响应到客户端的数据 xhr.responseText</span></span><br><span class="line">xhr.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="number">2</span>)</span><br><span class="line">	<span class="built_in">console</span>.log(xhr.responseText)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p><img src="AJAX.assets/image-20200513194319531.png" alt="image-20200513194319531"></p>
<h3 id="Ajax-封装"><a href="#Ajax-封装" class="headerlink" title="Ajax 封装"></a>Ajax 封装</h3><p>发送一次请求代码过多，封装函数即可解决这个问题</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ajax(&#123;</span><br><span class="line">	type:<span class="string">'get'</span>,</span><br><span class="line">	url:<span class="string">'http://www.gsau.edu.cn'</span>,</span><br><span class="line">	success:<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(data)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajax</span>(<span class="params">options</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">	xhr.open(options.type,options.url);</span><br><span class="line">	xhr.send()</span><br><span class="line">	xhr.onload=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		options.success(xhr.responseText)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">ajax(&#123;</span><br><span class="line">	type:<span class="string">'get'</span>,</span><br><span class="line">	url:<span class="string">'http://localhost:3000/first'</span>,</span><br><span class="line">	success:<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(data)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="AJAX.assets/image-20200514081243588.png" alt="image-20200514081243588"></p>
<h4 id="请求参数的问题"><a href="#请求参数的问题" class="headerlink" title="请求参数的问题"></a>请求参数的问题</h4><ol>
<li><p>请求参数位置的问题：将请求参数传递到ajax函数内部</p>
<p>get放在请求地址的后面，post需要放在send方法中。</p>
</li>
<li><p>请求参数格式的问题，</p>
<p><code>application/x-www-form-urlecoded</code>      <code>name=zhangsan&amp;age=20</code></p>
<p><code>application/json</code>                                         <code>{name:&#39;zhangsan&#39;,age:20}</code></p>
</li>
</ol>
<p>综合使用对象格式传递参数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端封装ajax函数，非必要参数使用默认值</span></span><br><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">		<span class="function"><span class="keyword">function</span> <span class="title">ajax</span>(<span class="params">options</span>)</span>&#123;</span><br><span class="line">			<span class="comment">// 存储默认值</span></span><br><span class="line">			<span class="keyword">var</span> defaults=&#123;</span><br><span class="line">				type:<span class="string">'get'</span>,</span><br><span class="line">				url:<span class="string">''</span>,</span><br><span class="line">				data:&#123;&#125;,</span><br><span class="line">				header:&#123;</span><br><span class="line">					<span class="string">'Content-Type'</span>:<span class="string">'application/x-www-form-urlecoded'</span></span><br><span class="line">				&#125;,</span><br><span class="line">				success:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;,</span><br><span class="line">				error:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// 使用options对象中的属性覆盖defaults对象中的属性</span></span><br><span class="line">			<span class="built_in">Object</span>.assign(defaults,options);</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 创建Ajax对象</span></span><br><span class="line">			<span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">			<span class="keyword">var</span> params = <span class="string">''</span>;<span class="comment">//拼接请求参数的字符串</span></span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">var</span> attr <span class="keyword">in</span> defaults.data)&#123;</span><br><span class="line">				params+= attr+<span class="string">'='</span>+defaults.data[attr] +<span class="string">'&amp;'</span></span><br><span class="line">			&#125;</span><br><span class="line">			params = params.substr(<span class="number">0</span>,params.length <span class="number">-1</span>)</span><br><span class="line">			<span class="comment">// 将对象格式拼接为地址参数格式</span></span><br><span class="line">			<span class="built_in">console</span>.log(params)</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 如果请求方式是get，就将参数拼接到地址上</span></span><br><span class="line">			<span class="keyword">if</span>(defaults.type==<span class="string">'get'</span>)&#123;</span><br><span class="line">				defaults.url = defaults.url+ <span class="string">'?'</span> +params;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// 配置ajax对象</span></span><br><span class="line">			xhr.open(defaults.type,defaults.url);</span><br><span class="line">			<span class="comment">// 如果请求参方式是post</span></span><br><span class="line">			<span class="keyword">if</span>(defaults.type == <span class="string">'post'</span> )&#123;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">var</span> contentType = defaults.header[<span class="string">'Content-Type'</span>]; <span class="comment">// !!!获得请求参数格式</span></span><br><span class="line">				xhr.setRequestHeader(<span class="string">'Content-Type'</span>,contentType)<span class="comment">// 设置请求参数格式类型</span></span><br><span class="line">				<span class="comment">// 如果参数格式是json，先转化为字符串格式然后，在send函数内作为请求体发送</span></span><br><span class="line">				<span class="keyword">if</span>(contentType == <span class="string">'application/json'</span>)&#123;</span><br><span class="line">					xhr.send(<span class="built_in">JSON</span>.stringify(defaults.data))</span><br><span class="line">				&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">					<span class="comment">// 向服务器端传递普通类型的参数</span></span><br><span class="line">					xhr.send(params)</span><br><span class="line">				&#125;</span><br><span class="line">				</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="comment">// GET方式send直接发送</span></span><br><span class="line">				xhr.send()</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			xhr.onload=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">				<span class="keyword">let</span> contentType = xhr.getResponseHeader(<span class="string">'Content-Type'</span>);</span><br><span class="line">				<span class="keyword">let</span> responseText = xhr.responseText;</span><br><span class="line">				<span class="comment">// 判断返回的数据类型是json，就把json字符串转换为json对象返回</span></span><br><span class="line">				<span class="keyword">if</span>(contentType.includes(<span class="string">'application/json'</span>))&#123;</span><br><span class="line">							responseText = <span class="built_in">JSON</span>.parse(responseText)</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="comment">// http状态 200 时调用success函数</span></span><br><span class="line">					<span class="keyword">if</span>(xhr.status == <span class="number">200</span>)&#123;</span><br><span class="line">						</span><br><span class="line">						<span class="built_in">console</span>.log(contentType);</span><br><span class="line">						<span class="comment">// xhr.getResponseHeader 获取响应头中的数据</span></span><br><span class="line">							<span class="comment">// 将结果返回调用处理函数处</span></span><br><span class="line">							defaults.success(responseText,xhr)</span><br><span class="line">						</span><br><span class="line">					&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">						defaults.error(responseText,xhr);</span><br><span class="line">					&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">				</span><br><span class="line">		<span class="comment">// 调用ajax函数，自动发送请求并得到返回结果</span></span><br><span class="line">		ajax(&#123;</span><br><span class="line">			url:<span class="string">'http://localhost:3000/responseData'</span>,</span><br><span class="line"></span><br><span class="line">			success:<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">				<span class="built_in">console</span>.log(<span class="string">'success函数：'</span>)</span><br><span class="line">				<span class="built_in">console</span>.log(data)</span><br><span class="line">			&#125;,</span><br><span class="line">			</span><br><span class="line">		&#125;)</span><br><span class="line">	&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 服务端</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>)</span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line">app.use(bodyParser.json());</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/first'</span>,(req,res)=&gt;&#123;</span><br><span class="line">	res.send(<span class="string">'hello ajax'</span>)<span class="comment">// 响应给客户端的信息</span></span><br><span class="line">&#125;);</span><br><span class="line">app.post(<span class="string">'/first'</span>,(req,res)=&gt;&#123;</span><br><span class="line">	res.send(req.body)<span class="comment">// 响应给客户端的信息</span></span><br><span class="line">&#125;);</span><br><span class="line">app.get(<span class="string">'/responseData'</span>,(req,res)=&gt;&#123;</span><br><span class="line">	res.send(&#123;<span class="string">'name'</span>:<span class="string">'zs'</span>&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><img src="AJAX.assets/image-20200514111015585.png" alt="image-20200514111015585"></p>
<h3 id="模板引擎概述-客户端"><a href="#模板引擎概述-客户端" class="headerlink" title="模板引擎概述(客户端)"></a>模板引擎概述(客户端)</h3><p>art-template</p>
<ol>
<li>下载并引入库文件</li>
</ol>
<figure class="highlight plain"><figcaption><span>src</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2. 准备art-template 模板</span><br><span class="line"></span><br><span class="line">   &#96;&#96;&#96; js</span><br><span class="line">   &lt;script id&#x3D;&#39;tp1&#39; type&#x3D;&quot;text&#x2F;html&quot;&gt;</span><br><span class="line">   	&lt;div class&#x3D;&#39;box&#39;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">   &lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>告诉模板引擎将那一个模板和哪个数据进行拼接</p>
<p><code>var html = temlate(&#39;tp1&#39;,{username:&#39;zhangsan&#39;,age:&#39;20&#39;});</code></p>
</li>
<li><p>将拼接好的html字符串添加到页面中</p>
<p><code>document.getElementById(&#39;container&#39;).innerHTML = html;</code></p>
</li>
<li><p>通过模板语法告诉模板引擎，数据和html字符串要如何拼接</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script id=<span class="string">'tp1'</span> type=<span class="string">"text/html"</span>&gt;</span><br><span class="line">	&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">'box'</span>&gt;&#123;&#123; username &#125;&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 案例：</span></span><br><span class="line">......</span><br><span class="line">&lt;script type=<span class="string">"text/javascript"</span> src=<span class="string">"js/template-web.js"</span>&gt;&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">......</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;div id="container"&gt;&lt;/</span>div&gt;</span><br><span class="line">	</span><br><span class="line">&lt;!-- <span class="number">1</span>、准备模板并且写入模板变量 --&gt;</span><br><span class="line">&lt;script id=<span class="string">"tp1"</span> type=<span class="string">"text/html"</span>&gt;</span><br><span class="line">	&lt;h1&gt;&#123;&#123;name&#125;&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">	&lt;h1&gt;&#123;&#123;age&#125;&#125;&lt;/</span>h1&gt;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;!-- 2、设置相应模板对应的数据对象，返回拼接好的html字符串 --&gt;</span></span><br><span class="line"><span class="regexp">&lt;script type="text/</span>javascript<span class="string">"&gt;</span></span><br><span class="line"><span class="string">	var html = template('tp1',&#123;</span></span><br><span class="line"><span class="string">		name:'zhangsan',</span></span><br><span class="line"><span class="string">		age:20</span></span><br><span class="line"><span class="string">	&#125;);</span></span><br><span class="line"><span class="string">	console.log(html)</span></span><br><span class="line"><span class="string">	// 3、将自动拼接好的网页字符串写入网页</span></span><br><span class="line"><span class="string">	document.getElementById('container').innerHTML= html;</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="AJAX.assets/image-20200514160813091.png" alt="image-20200514160813091"></p>
<h3 id="案例·1：验证邮箱地址的唯一性"><a href="#案例·1：验证邮箱地址的唯一性" class="headerlink" title="案例·1：验证邮箱地址的唯一性"></a>案例·1：验证邮箱地址的唯一性</h3><p>【有问题，暂留】</p>
<h3 id="案例2：案例搜索框内容自动提示"><a href="#案例2：案例搜索框内容自动提示" class="headerlink" title="案例2：案例搜索框内容自动提示"></a>案例2：案例搜索框内容自动提示</h3><h3 id="案例-3-：省市区联动（ok）"><a href="#案例-3-：省市区联动（ok）" class="headerlink" title="案例 3 ：省市区联动（ok）"></a>案例 3 ：省市区联动（ok）</h3><h3 id="FormDate"><a href="#FormDate" class="headerlink" title="FormDate"></a>FormDate</h3><h4 id="FormDate-对象的作用"><a href="#FormDate-对象的作用" class="headerlink" title="FormDate 对象的作用"></a>FormDate 对象的作用</h4><ol>
<li>模拟THML表单，相当于将HTML表单映射成表单对象，自动将表单对象中的数据拼接成请求参数的格式</li>
<li>异步上传二进制文件</li>
</ol>
<h4 id="FormData对象的使用"><a href="#FormData对象的使用" class="headerlink" title="FormData对象的使用"></a>FormData对象的使用</h4><ol>
<li><strong>准备HTML 表单</strong></li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"form"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">name</span>=<span class="string">""</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>



<ol start="2">
<li><strong>将HTML表单转化为formdata 对象</strong></li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> form = <span class="built_in">document</span>.getElementById(<span class="string">'form'</span>);</span><br><span class="line"><span class="keyword">var</span> formData = <span class="keyword">new</span> FormData(form);</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>提交表单对象</strong></li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xhr.send(formData)</span><br></pre></td></tr></table></figure>

<p>formData  只能用于post请求</p>
<blockquote>
<p>在这里，使用formidable模块来使得服务端解析客户端发送的FormData对象的数据</p>
</blockquote>
<p>它的使用方法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> <span class="comment">// 创建formidable表单解析对象</span></span><br><span class="line">	<span class="keyword">const</span> form = <span class="keyword">new</span> formidable.IncomingForm();</span><br><span class="line"><span class="number">2.</span> <span class="comment">// 解析客户端传递过来的FormData对象</span></span><br><span class="line">	form.parse(req, (err, fields, files) =&gt; &#123;</span><br><span class="line">		res.send(fields);</span><br><span class="line">	&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端</span></span><br><span class="line">&lt;form id=<span class="string">"form"</span>&gt;</span><br><span class="line">		&lt;input type=<span class="string">"text"</span> name=<span class="string">"username"</span>&gt;</span><br><span class="line">		&lt;input type=<span class="string">"password"</span> name=<span class="string">"password"</span>&gt;</span><br><span class="line">		&lt;input type=<span class="string">"button"</span> id=<span class="string">'btn'</span> value=<span class="string">"提交"</span>&gt;</span><br><span class="line">&lt;<span class="regexp">/form&gt;</span></span><br><span class="line"><span class="regexp">	&lt;script type="text/</span>javascript<span class="string">" src="</span>../js/ajax.js<span class="string">"&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">	&lt;script type="</span>text/javascript<span class="string">"&gt;</span></span><br><span class="line"><span class="string">		var btn = document.getElementById('btn');</span></span><br><span class="line"><span class="string">		var form = document.getElementById('form');</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">		btn.onclick = function()&#123;</span></span><br><span class="line"><span class="string">			var formData = new FormData(form);</span></span><br><span class="line"><span class="string">			var xhr = new XMLHttpRequest();</span></span><br><span class="line"><span class="string">			xhr.open('post','http://localhost:3000/formData')</span></span><br><span class="line"><span class="string">			xhr.send(formData);</span></span><br><span class="line"><span class="string">			xhr.onload=function()&#123;</span></span><br><span class="line"><span class="string">				if(xhr.status == 200)&#123;</span></span><br><span class="line"><span class="string">					console.log(xhr.responseText)</span></span><br><span class="line"><span class="string">				&#125;</span></span><br><span class="line"><span class="string">			&#125;</span></span><br><span class="line"><span class="string">		&#125;</span></span><br><span class="line"><span class="string">	&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 服务端</span></span><br><span class="line">app.post(<span class="string">'/formData'</span>, (req, res) =&gt; &#123;</span><br><span class="line">	<span class="comment">// 创建formidable表单解析对象</span></span><br><span class="line">	<span class="keyword">const</span> form = <span class="keyword">new</span> formidable.IncomingForm();</span><br><span class="line">	<span class="comment">// 解析客户端传递过来的FormData对象</span></span><br><span class="line">	form.parse(req, (err, fields, files) =&gt; &#123;</span><br><span class="line">		res.send(fields);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="FormData-对象的实例方法"><a href="#FormData-对象的实例方法" class="headerlink" title="FormData 对象的实例方法"></a>FormData 对象的实例方法</h4><ol>
<li>获取表单对象中的值</li>
</ol>
<p><code>formData.get(&#39;key&#39;)</code></p>
<ol start="2">
<li>设置表单对象中属性的值</li>
</ol>
<p><code>formData.set(&#39;key&#39;,&#39;value&#39;)</code></p>
<ol start="3">
<li><p>删除表单对象中属性的值</p>
<p><code>formData.delete(&#39;key&#39;)</code></p>
</li>
<li><p>向表单对象中追加属性值</p>
</li>
</ol>
<p><code>formData.append(&#39;key&#39;,&#39;value&#39;)</code></p>
<p>注意：set方法与append方法的区别是，在属性名已存在的情况下，set 会覆盖已有键名的值，append会保留两个值。服务器端会默认接受最后一个重名的键值。</p>
<p><img src="AJAX.assets/image-20200518213342180.png" alt="image-20200518213342180"></p>
<h4 id="FormData-二进制文件上传"><a href="#FormData-二进制文件上传" class="headerlink" title="FormData 二进制文件上传"></a>FormData 二进制文件上传</h4><p><code>&lt;input type=&#39;file&#39; id=&#39;file&#39;/&gt;</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端</span></span><br><span class="line">&lt;form id=<span class="string">"form"</span>&gt;</span><br><span class="line">		&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"form-group"</span>&gt;</span><br><span class="line">			&lt;label&gt;请选择文件&lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">			&lt;input type="file" id="file"&gt;</span></span><br><span class="line"><span class="regexp">			&lt;input type="button" id='btn' value="提交"&gt;</span></span><br><span class="line"><span class="regexp">			&lt;div class="progress"&gt;</span></span><br><span class="line"><span class="regexp">				&lt;div class="progress-bar" style="width: 0%;" id="bar"&gt;0%&lt;/</span>div&gt;</span><br><span class="line">			&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">			&lt;!-- &lt;progress value="" max="" id="bar"&gt;&lt;/</span>progress&gt; --&gt;</span><br><span class="line">		&lt;<span class="regexp">/div&gt;		</span></span><br><span class="line"><span class="regexp">	&lt;/</span>form&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">		<span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">'btn'</span>);</span><br><span class="line">		<span class="keyword">var</span> file = <span class="built_in">document</span>.getElementById(<span class="string">'file'</span>);</span><br><span class="line">		<span class="keyword">var</span> bar = <span class="built_in">document</span>.getElementById(<span class="string">'bar'</span>)</span><br><span class="line"></span><br><span class="line">		file.onchange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">			<span class="keyword">var</span> formData = <span class="keyword">new</span> FormData();</span><br><span class="line">			<span class="comment">// 将文件追加到FormData对象中，默认文件控件有一个数组是保存文件的</span></span><br><span class="line">			formData.append(<span class="string">'attrname'</span>,<span class="keyword">this</span>.files[<span class="number">0</span>]);</span><br><span class="line">			<span class="comment">// 创建并设置、发送ajax请求，然后监听服务端返回的信息</span></span><br><span class="line">			<span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">			xhr.open(<span class="string">'post'</span>,<span class="string">'http://localhost:3000/upload'</span>);</span><br><span class="line">			<span class="comment">// 在文件上传过程中持续触发</span></span><br><span class="line">			xhr.upload.onprogress = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">				<span class="comment">// console.log(e)</span></span><br><span class="line">				<span class="keyword">let</span> result = (e.loaded/e.total) * <span class="number">100</span> +<span class="string">'%'</span>;</span><br><span class="line">				<span class="comment">// 设置进度条百分比</span></span><br><span class="line">				bar.style.width = result ;</span><br><span class="line">				<span class="comment">// 设置进度条显示百分比</span></span><br><span class="line">				bar.innerHTML= result ;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			xhr.send(formData)</span><br><span class="line">			xhr.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">				<span class="keyword">if</span>(xhr.status == <span class="number">200</span>)&#123;</span><br><span class="line">					<span class="built_in">console</span>.log(xhr.responseText)</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;	</span><br><span class="line">	&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 服务端</span></span><br><span class="line">app.post(<span class="string">'/upload'</span>,(req,res)=&gt;&#123;</span><br><span class="line">	<span class="comment">// 创建formidable表单解析对象</span></span><br><span class="line">	<span class="keyword">const</span> form = <span class="keyword">new</span> formidable.IncomingForm();</span><br><span class="line">	<span class="comment">// 设置客户端上传文件的存储路径</span></span><br><span class="line">	form.uploadDir = path.join(__dirname,<span class="string">'public'</span>,<span class="string">'uploads'</span>)</span><br><span class="line">	<span class="comment">// 保留上传文件的后缀名字</span></span><br><span class="line">	form.keepExtensions = <span class="literal">true</span>;</span><br><span class="line">	<span class="comment">// 解析客户端传递过来的FormData对象</span></span><br><span class="line">	form.parse(req,(err,fields,files)=&gt;&#123;</span><br><span class="line">		res.send(<span class="string">'ok'</span>)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="AJAX.assets/image-20200519144658067.png" alt="image-20200519144658067"></p>
<h4 id="FormData-文件上传图片即时预览"><a href="#FormData-文件上传图片即时预览" class="headerlink" title="FormData 文件上传图片即时预览"></a>FormData 文件上传图片即时预览</h4><p>在将图片上传至服务端以后，服务端通常都会将图片地址作为相应数据传递给客户端，客户端可以从响应数据中获取图片地址，然后将图片再显示在页面中。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端</span></span><br><span class="line">xhr.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">				<span class="keyword">if</span>(xhr.status == <span class="number">200</span>)&#123;</span><br><span class="line">					<span class="keyword">var</span> result = <span class="built_in">JSON</span>.parse(xhr.responseText)</span><br><span class="line">					<span class="comment">// 动态创建img表单</span></span><br><span class="line">					<span class="keyword">var</span> img = <span class="built_in">document</span>.createElement(<span class="string">'img'</span>);</span><br><span class="line">					img.src = result.path;</span><br><span class="line">					img.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">						box.appendChild(img);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 服务端</span></span><br><span class="line">form.parse(req,(err,fields,files)=&gt;&#123;</span><br><span class="line">		res.send(&#123;</span><br><span class="line">			path:files.attrname.path.split(<span class="string">'public'</span>)[<span class="number">1</span>],</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="Ajax同源政策"><a href="#Ajax同源政策" class="headerlink" title="Ajax同源政策"></a>Ajax同源政策</h3><h4 id="Ajax请求限制"><a href="#Ajax请求限制" class="headerlink" title="Ajax请求限制"></a>Ajax请求限制</h4><p>Ajax只能向自己的服务器发送请求，比如现有一A网站，有一B网站，A网站的html文件只能向A网站服务器发送Ajax请求，B同样是这样，但是A网站不能向B网站发送Ajax请求，同理，B网站也不能向A网站发送Ajax请求。</p>
<h5 id="什么是同源？？？"><a href="#什么是同源？？？" class="headerlink" title="什么是同源？？？"></a>什么是同源？？？</h5><p>​    如果两个页面拥有相同的<strong>协议</strong>、<strong>域名</strong>和<strong>端口</strong>，那么这两个页面就属于同一个源，其中只要一个不相同，就是不同源。端口默认值80。</p>
<h4 id="使用JSONP-解决同源限制问题"><a href="#使用JSONP-解决同源限制问题" class="headerlink" title="使用JSONP 解决同源限制问题"></a>使用JSONP 解决同源限制问题</h4><p>jsonp 是 json with padding 的缩写，它不属于Ajax请求，但它可以模拟Ajax请求</p>
<p>客户端：函数的定义和   （服务端函数的）调用</p>
<p>在服务端将json数据作为函数的参数，通过参数返回客户端的原函数，即填充（padding）json数据，实现了非同源向客户端发送数据的需求，可以看到的是，需要服务端需要和客户端的函数保持一致。</p>
<ol>
<li>将不同源的服务端请求地址写在script标签的src 属性中</li>
</ol>
<p><img src="AJAX.assets/6D9C62D432FB072C67939240DD70CFE8.png" alt="6D9C62D432FB072C67939240DD70CFE8"></p>
<ol start="2">
<li>服务器端响应数据必须是一个函数的调用，真正要发送给客户端的数据需要作为函数调用的参数</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> data = <span class="string">'fn(&#123;name:"zs",age:"20"&#125;)'</span>;</span><br><span class="line">res.send(data)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>在客户端提前准备好这个函数的定义，在客户端全局作用域下定义函数fn</p>
<p><code>function fn(data){}</code></p>
</li>
<li><p>在fn函数内部对服务端返回的数据进行处理</p>
<p><code>function fn(data){console.log(data);}</code></p>
</li>
</ol>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端</span></span><br><span class="line">&lt;script&gt; </span><br><span class="line">           <span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">           	<span class="built_in">console</span>.log(<span class="string">'客户端的fn函数被调用了'</span>)</span><br><span class="line">           	<span class="built_in">console</span>.log(data)</span><br><span class="line">           &#125;</span><br><span class="line">	&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">	&lt;!-- 1 请求地址写在script --&gt;</span></span><br><span class="line"><span class="regexp">	&lt;script src="http:/</span><span class="regexp">/localhost:3001/</span>test<span class="string">" type="</span>text/javascript<span class="string">" charset="</span>utf<span class="number">-8</span><span class="string">"&gt;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// :3001  服务端</span></span><br><span class="line">app.get(<span class="string">'/test'</span>,(req,res)=&gt;&#123;</span><br><span class="line">	<span class="keyword">const</span> result = <span class="string">'fn(&#123;name:"张三"&#125;)'</span>;</span><br><span class="line">	res.send(result)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听端口</span></span><br><span class="line">app.listen(<span class="number">3001</span>);</span><br><span class="line"><span class="comment">// 控制台提示输出</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'服务器启动成功'</span>);</span><br></pre></td></tr></table></figure>

<p><img src="AJAX.assets/image-20200519172600170.png" alt="image-20200519172600170"></p>
<h4 id="JSONP-代码优化"><a href="#JSONP-代码优化" class="headerlink" title="JSONP 代码优化"></a>JSONP 代码优化</h4><ol>
<li>客户端需要将函数名称传递到服务器端</li>
<li>将script 请求的发送变成动态请求</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;button type=<span class="string">""</span> id=<span class="string">"btn"</span>&gt;点我发送请求&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">	&lt;script&gt; </span></span><br><span class="line"><span class="regexp">           function fn3(data)&#123;</span></span><br><span class="line"><span class="regexp">           	console.log('客户端的fn函数被调用了')</span></span><br><span class="line"><span class="regexp">           	console.log(data)</span></span><br><span class="line"><span class="regexp">           &#125;</span></span><br><span class="line"><span class="regexp">	&lt;/</span>script&gt;</span><br><span class="line">	&lt;!-- <span class="number">1</span> 请求地址写在script --&gt;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	&lt;script&gt;</span><br><span class="line">		<span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">'btn'</span>)</span><br><span class="line">		btn.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">			<span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span><br><span class="line">			<span class="comment">// 设置src属性</span></span><br><span class="line">			script.src = <span class="string">`http://localhost:3001/better?callback=fn3`</span>;</span><br><span class="line">			<span class="comment">// 将script标签追加到页面中</span></span><br><span class="line">			<span class="built_in">document</span>.body.appendChild(script)</span><br><span class="line">			script.onload= <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">				<span class="built_in">document</span>.body.removeChild(script);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">'/better'</span>,(req,res)=&gt;&#123;</span><br><span class="line">	<span class="comment">// 接受客户端传递过来的名称</span></span><br><span class="line">	<span class="keyword">const</span> fnName = req.query.callback;</span><br><span class="line">	<span class="comment">// 将函数名称对应的函数调用代码返回客户端</span></span><br><span class="line">	<span class="keyword">const</span> result = fnName+<span class="string">'(&#123;name:"张三"&#125;)'</span>;</span><br><span class="line">	res.send(result)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>封装jsonp 函数，方便请求发送</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">jsonp</span>(<span class="params">options</span>)</span>&#123;</span><br><span class="line">			<span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span><br><span class="line">			<span class="keyword">var</span> fnName = <span class="string">'myJsonp'</span> + <span class="built_in">Math</span>.random().toString().replace(<span class="string">'.'</span>,<span class="string">''</span>)</span><br><span class="line">			<span class="built_in">window</span>[fnName] = options.success;</span><br><span class="line">			script.src = options.url+<span class="string">'?callback='</span>+fnName;</span><br><span class="line">			<span class="built_in">document</span>.body.appendChild(script);</span><br><span class="line">			script.onload= <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">				<span class="built_in">document</span>.body.removeChild(script)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">     	<span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">'btn'</span>)</span><br><span class="line"></span><br><span class="line">		btn.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">			jsonp(&#123;</span><br><span class="line">			url:<span class="string">'http://localhost:3001/better'</span>,</span><br><span class="line">			success:<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">				<span class="built_in">console</span>.log(<span class="number">123</span>);</span><br><span class="line">				<span class="built_in">console</span>.log(data)</span><br><span class="line">			&#125;</span><br><span class="line">			&#125;);</span><br><span class="line"></span><br><span class="line">		&#125;;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">var</span> btn1 = <span class="built_in">document</span>.getElementById(<span class="string">'btn1'</span>)</span><br><span class="line"></span><br><span class="line">		btn1.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">			jsonp(&#123;</span><br><span class="line">			url:<span class="string">'http://localhost:3001/better'</span>,</span><br><span class="line">			success:<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">				<span class="built_in">console</span>.log(<span class="number">456</span>);</span><br><span class="line">				<span class="built_in">console</span>.log(data)</span><br><span class="line">			&#125;</span><br><span class="line">			&#125;);</span><br><span class="line"></span><br><span class="line">		&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 服务端</span></span><br><span class="line">app.get(<span class="string">'/better'</span>,(req,res)=&gt;&#123;</span><br><span class="line">	<span class="comment">// 接受客户端传递过来的名称</span></span><br><span class="line">	<span class="keyword">const</span> fnName = req.query.callback;</span><br><span class="line">	<span class="comment">// 将函数名称对应的函数调用代码返回客户端</span></span><br><span class="line">	<span class="keyword">const</span> result = fnName+<span class="string">'(&#123;name:"张三"&#125;)'</span>;</span><br><span class="line">	setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">		res.send(result)</span><br><span class="line">	&#125;,<span class="number">1000</span>)</span><br><span class="line">	</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="案例：腾讯天气（待补充）"><a href="#案例：腾讯天气（待补充）" class="headerlink" title="案例：腾讯天气（待补充）"></a>案例：腾讯天气（待补充）</h3><h4 id="访问非同源数据-服务器端解决方案"><a href="#访问非同源数据-服务器端解决方案" class="headerlink" title="访问非同源数据 服务器端解决方案"></a>访问非同源数据 服务器端解决方案</h4><p>同源政策是浏览器给予Ajax技术的限制，服务器端是不存在同源政策限制</p>
<p><img src="AJAX.assets/39662EE7A9F5FB5022BD02320FBC7090.png" alt="39662EE7A9F5FB5022BD02320FBC7090"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//客户端</span></span><br><span class="line">&lt;button type=<span class="string">""</span> id=<span class="string">"btn"</span>&gt;点我发送请求&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script src="../</span>js/ajax.js<span class="string">"&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">    &lt;script type="</span>text/javascript<span class="string">"&gt;</span></span><br><span class="line"><span class="string">    	var btn = document.getElementById('btn')</span></span><br><span class="line"><span class="string">	btn.onclick = function()&#123;</span></span><br><span class="line"><span class="string">		ajax(&#123;</span></span><br><span class="line"><span class="string">			type:'get',</span></span><br><span class="line"><span class="string">			url:'http://localhost:3000/server',</span></span><br><span class="line"><span class="string">			success:function(data)&#123;</span></span><br><span class="line"><span class="string">				console.log(data);</span></span><br><span class="line"><span class="string">			&#125;</span></span><br><span class="line"><span class="string">		&#125;)</span></span><br><span class="line"><span class="string">	&#125;;</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 同源服务端</span></span><br><span class="line">app.get(<span class="string">'/server'</span>,(req,res)=&gt;&#123;</span><br><span class="line">	request(<span class="string">'http://localhost:3001/cross'</span>,(err,response,body)=&gt;&#123;</span><br><span class="line">		<span class="comment">// console.log(err)</span></span><br><span class="line">		<span class="comment">// console.log(response)</span></span><br><span class="line">		<span class="comment">// console.log(body)</span></span><br><span class="line">		res.send(body)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 非同源服务端</span></span><br><span class="line">app.get(<span class="string">'/cross'</span>,(req,res)=&gt;&#123;</span><br><span class="line">	res.send(<span class="string">'ok'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="AJAX.assets/image-20200521152847254.png" alt="image-20200521152847254"></p>
<h4 id="跨域请求之cookie"><a href="#跨域请求之cookie" class="headerlink" title="跨域请求之cookie"></a>跨域请求之cookie</h4><p>客户端与服务器端使用HTTP协议（无状态）交换信息</p>
<p>cookie是实现服务端与客户端身份识别的一种技术，由服务端响应cookie给客户端，由客户端请求时一并发送cookie，就实现了身份识别。</p>
<p><img src="AJAX.assets/C3092A7C949F3673D3111CB0EC4D2EA6.png" alt="C3092A7C949F3673D3111CB0EC4D2EA6"></p>
<h4 id="withCredentials-属性"><a href="#withCredentials-属性" class="headerlink" title="withCredentials 属性"></a>withCredentials 属性</h4><p>在使用Ajax技术发送跨域请求时，默认情况下不会在请求中携带cookie信息。</p>
<p>在<strong>客户端</strong>  withCredentials :指定在涉及到跨域请求时，是否携带cookie信息，默认值为false</p>
<p>在<strong>服务器端</strong>，响应头中设置 Access-Control-Allow-Credentials:true  允许客户端发送请求时携带cookie</p>
<p>具体看本地实际代码设置</p>
<p>参考链接：<a href="http://www.ruanyifeng.com/blog/2016/04/cors.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2016/04/cors.html</a></p>
<h3 id="ajax-方法概述"><a href="#ajax-方法概述" class="headerlink" title="$.ajax() 方法概述"></a>$.ajax() 方法概述</h3><p>作用：发送Ajax请求</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line">    type:<span class="string">'get'</span>,</span><br><span class="line">    url:<span class="string">'http://www.example.com'</span>,</span><br><span class="line">    data:&#123;<span class="attr">name</span>:<span class="string">'zhangsan'</span>,<span class="attr">age</span>:<span class="string">'20'</span>&#125;,</span><br><span class="line">    contentType:<span class="string">'application/x-www-for-urlencoded'</span>,</span><br><span class="line">    beforeSend:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    success:<span class="function"><span class="keyword">function</span>(<span class="params">response</span>)</span>&#123;&#125;,</span><br><span class="line">    error:<span class="function"><span class="keyword">function</span>(<span class="params">xhr</span>)</span>&#123;&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

</div></article></div></main><footer><div class="paginator"><a href="/2021/04/24/%E6%96%B0%E9%A1%B5%E9%9D%A2/" class="prev">PREV</a></div><div class="copyright"><p>© 2015 - 2021 <a href="https://github.com/ER-Tiylor/ER_Tiylor.github.io">你猜</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>