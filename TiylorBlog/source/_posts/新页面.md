---
title: 新页面
date: 2021-04-24 23:34:31
tags:
---
### Express框架简介

Express是一个基于Node平台的web应用开发框架，它提供了一系列的强大特性，帮助你创建各种web应用。

可以使用```  npm install express ```下载

### 特性

- 提供方便简洁的路由定义方式
- 对获取HTTP请求参数进行了简化处理
- 对模板引擎支持程度高
- 提供了中间件机制有效控制HTTP请求
- 拥有大量第三方中间件对功能进行扩展

原生node.js与Express对比之路由

![134920DFB17BAD28E13E6426C63CBBE7](D:\receive-file\QQ-file\MobileFile\134920DFB17BAD28E13E6426C63CBBE7.png)

![0ED4F0B78272165EBEB967ED945DC4D7](D:\receive-file\QQ-file\MobileFile\0ED4F0B78272165EBEB967ED945DC4D7.png)

### 中间件

中间件就是一堆方法，可以接受客户端发来的请求，可以对请求做出响应，也可以将请求继续交给下一个中间件继续处理。![7037704669C036866036312F1FEAB567](E:\0a文档\前端笔记\7037704669C036866036312F1FEAB567.png)



中间件主要由两部分构成，**中间件方法**以及**请求处理函数**。

**中间件方法**由Express提供，负责拦截请求，**请求处理函数**由开发人间提供，负责处理请求。

```js
app.get('请求路径', '处理函数') // 接受并处理get请求
app.post('请求路径', '处理函数') // 接受并处理post请求
```

可以针对同一个请求设置多个中间件，对同一个请求进行多次处理

默认情况下，请求从上到下依次匹配中间件，一旦匹配成功，终止匹配

可以调用next方法将请求的控制权交给下一个中间件，知道遇到结束请求的中间件。

![12D81ED1B719053ADE20CCB9D9DBF113](E:\0a文档\前端笔记\12D81ED1B719053ADE20CCB9D9DBF113.png)

```
// 引入express框架
const express = require('express')
// 创建网站服务器
const app = express();

app.get('/request',(req,res,next)=>{
	req.name = '张三';
	next();
})
app.get('/request',(req,res)=>{
	res.send(req.name)
})

// 监听端口
app.listen(3000);
console.log('网站服务器启动成功');
```

![image-20200507113527474](E:\0a文档\前端笔记\image-20200507113527474.png)

#### app.use 中间件用法

app.use 匹配所有的请求方式，可以直接传入请求处理函数，代表接受所有的请求

```js
app.use((req,res,next)=>{

​	console,log(req.url);

​	next()

})
```

app.use 第一个参数也可以传入请求地址，代表不论什么请求方式，只要是这个请求地址就接收这个请求

```
app.use('/admin',(req,res,next)=>{
	console.log(req.url);
	next()
})
```



```
// 引入express框架
const express = require('express')
// 创建网站服务器
const app = express();
// 接受所有请求的中间件
app.use((req,res,next)=>{
	
	console.log("请求走了app.use 中间件")
	next()
})
app.use('/request',(req,res,next)=>{
	
	console.log("请求走了app.use request 中间件")
	next()
})
app.get('/request',(req,res)=>{
	res.send('req.name')
})
app.get('/list',(req,res)=>{
	res.send('/list')
})
```

![image-20200507114954208](E:\0a文档\前端笔记\image-20200507114954208.png)

#### 中间件应用

1. 路由保护，客户端在访问需要登录的页面时，可以先使用中间件判断用户登录状态，用户如果未登录，则拦截请求，直接响应，禁止用户进入需要登录的页面

```js
app.use('/admin',(req,res,next)=>{
	let isLogin = false;
	if(isLogin){
		next()
	}else{
		res.send('您还么有登录，不能访问admin页面22')
	}
})
app.get('/admin',(req,res)=>{
	res.send('您已经登录，可以访问当前页面')
})
```

2. 网站维护公告，在所有路由的最上面定义接收所有请求的中间件，直接为客户端做出响应，网站正在维护中。

```js
app.use((req,res,next)=>{
	res.send('正在维护')
})
```

3. 自定义404页面

在所有路由的最后面

```
app.use((req,res,next)=>{
	res.status(404).send('当前页面不存在')  
})
```

![image-20200507120623542](E:\0a文档\前端笔记\image-20200507120623542.png)

#### 错误处理中间件

如文件读取失败、数据库连接失败，错误处理中间件是一个集中处理错误的地方

```
app.use((err,req,res,next)=>{
	res.status(500).send('服务器发生未知错误')
})
```

```
![6303E7C52E1604E98FC32F85C058FF66](D:\receive-file\QQ-file\MobileFile\6303E7C52E1604E98FC32F85C058FF66.pngapp.get('/index',(req,res)=>{
	throw new Error('程序发生了未知错误')
	res.send('ok')
})

// 错误处理中间件
app.use((err,req,res,next)=>{
	res.status(500).send(err.message)
})

```

![image-20200507121913920](E:\0a文档\前端笔记\image-20200507121913920.png)

![6303E7C52E1604E98FC32F85C058FF66](E:\0a文档\前端笔记\6303E7C52E1604E98FC32F85C058FF66.png)

```
app.get('/index',(req,res,next)=>{
	// throw new Error('程序发生了未知错误')
	fs.readFile('./demo.txt','utf8',(err,result)=>{
		if(err){
			next(err)
		}else{
			res.send(result)
		}
	})
	// res.send('ok')
})
```

![image-20200507122447026](E:\0a文档\前端笔记\image-20200507122447026.png)



#### 捕获错误

在node.js中，异步API的错误信息都是通过回调函数获取的，**支持Promise对象的异步API发生错误可以通过catch方法捕获**。

try catch 可以捕获**异步函数**以及其他**同步代码在执行过程中发生的错误**，但是*不能捕获其他类型的API发生的错误*

![C0E555174588CE6CAAAF969641FA566F](E:\0a文档\前端笔记\C0E555174588CE6CAAAF969641FA566F.png)

当try块中的代码发生错误就执行catch块中的代码，使用next方法手动触发错误处理中间件

```js
// 引入express框架
const express = require('express')
const fs = require('fs')
const promisify = require('util').promisify;
const readFile = promisify(fs.readFile);
// 创建网站服务器
const app = express();
app.get('/index',async (req,res,next)=>{
	try{
		await readFile('/aaa.js')
	}catch(err){
		next(err)
	}	
})

// 错误处理中间件
app.use((err,req,res,next)=>{
	res.status(500).send(err.message)
})
// 监听端口
app.listen(3000);
console.log('网站服务器启动成功');
```

![image-20200507123839416](E:\0a文档\前端笔记\image-20200507123839416.png)

#### 构建模块化路由

```js
const express = require('express')

// 创建路由对象

const home = express.Router()

// 将路由和请求路径进行匹配

app.use('/home',home);  // home 一级路由

home.get('/index',()=>{
    // /home/index   二级路由
    res.send('欢迎来到博客展示页面')
})
```

![image-20200507151446191](E:\0a文档\前端笔记\image-20200507151446191.png)

![11DA62269FAE999D5462A9BE5AB386DF](E:\0a文档\前端笔记\11DA62269FAE999D5462A9BE5AB386DF.png)

![image-20200507153300457](E:\0a文档\前端笔记\image-20200507153300457.png)![image-20200507153312320](E:\0a文档\前端笔记\image-20200507153312320.png)

### Express 请求处理

#### GET参数的获取

Express框架中使用 ```req.query``` 即可获取GET参数，框架内部会将GET参数转换为对象并返回。

![0CE07542C0BBEFA93C0CDF0485AEED30](E:\0a文档\前端笔记\0CE07542C0BBEFA93C0CDF0485AEED30.png)